-- WarpahVIP ESP & Wallhack
-- Professional Edition

local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local LocalPlayer = Players.LocalPlayer

-- Settings
local ESPEnabled = false
local HighlightEnabled = true
local HealthBarEnabled = true
local DistanceEnabled = true
local TracersEnabled = false
local BoxESPEnabled = false
local ESPColor = Color3.fromRGB(255, 50, 50)
local TeamCheckEnabled = false

-- Storage
local ESPObjects = {}
local Connections = {}

-- UI Library
local ScreenGui = Instance.new("ScreenGui")
local MainFrame = Instance.new("Frame")
local Title = Instance.new("TextLabel")
local MinimizeBtn = Instance.new("TextButton")
local CloseBtn = Instance.new("TextButton")
local ContentFrame = Instance.new("Frame")
local StatusLabel = Instance.new("TextLabel")

-- Setup GUI
ScreenGui.Parent = game.CoreGui
ScreenGui.Name = "WarpahVIPESP"
ScreenGui.ZIndexBehavior = Enum.ZIndexBehavior.Sibling
ScreenGui.ResetOnSpawn = false

-- Main Frame - Subtle dark theme
MainFrame.Parent = ScreenGui
MainFrame.BackgroundColor3 = Color3.fromRGB(25, 25, 30)
MainFrame.BorderSizePixel = 0
MainFrame.Position = UDim2.new(0.5, -160, 0.5, -200)
MainFrame.Size = UDim2.new(0, 320, 0, 400)
MainFrame.Active = true
MainFrame.Draggable = true

local Corner = Instance.new("UICorner")
Corner.CornerRadius = UDim.new(0, 8)
Corner.Parent = MainFrame

-- Subtle border effect
local MainStroke = Instance.new("UIStroke")
MainStroke.Color = Color3.fromRGB(60, 60, 65)
MainStroke.Thickness = 1
MainStroke.Transparency = 0
MainStroke.Parent = MainFrame

-- Title Bar
Title.Parent = MainFrame
Title.BackgroundColor3 = Color3.fromRGB(20, 20, 25)
Title.BorderSizePixel = 0
Title.Size = UDim2.new(1, 0, 0, 35)
Title.Font = Enum.Font.Gotham
Title.Text = "WarpahVIP ESP"
Title.TextColor3 = Color3.fromRGB(220, 220, 225)
Title.TextSize = 13

local TitleCorner = Instance.new("UICorner")
TitleCorner.CornerRadius = UDim.new(0, 8)
TitleCorner.Parent = Title

-- Minimize Button - Clean design
MinimizeBtn.Parent = MainFrame
MinimizeBtn.BackgroundColor3 = Color3.fromRGB(40, 40, 45)
MinimizeBtn.BorderSizePixel = 0
MinimizeBtn.Position = UDim2.new(1, -60, 0, 8)
MinimizeBtn.Size = UDim2.new(0, 24, 0, 20)
MinimizeBtn.Font = Enum.Font.Gotham
MinimizeBtn.Text = "—"
MinimizeBtn.TextColor3 = Color3.fromRGB(180, 180, 185)
MinimizeBtn.TextSize = 12

local MinCorner = Instance.new("UICorner")
MinCorner.CornerRadius = UDim.new(0, 4)
MinCorner.Parent = MinimizeBtn

-- Close Button - Clean design
CloseBtn.Parent = MainFrame
CloseBtn.BackgroundColor3 = Color3.fromRGB(40, 40, 45)
CloseBtn.BorderSizePixel = 0
CloseBtn.Position = UDim2.new(1, -32, 0, 8)
CloseBtn.Size = UDim2.new(0, 24, 0, 20)
CloseBtn.Font = Enum.Font.Gotham
CloseBtn.Text = "×"
CloseBtn.TextColor3 = Color3.fromRGB(180, 180, 185)
CloseBtn.TextSize = 16

local CloseCorner = Instance.new("UICorner")
CloseCorner.CornerRadius = UDim.new(0, 4)
CloseCorner.Parent = CloseBtn

-- Content Frame
ContentFrame.Parent = MainFrame
ContentFrame.BackgroundTransparency = 1
ContentFrame.Position = UDim2.new(0, 0, 0, 35)
ContentFrame.Size = UDim2.new(1, 0, 1, -35)

-- Status Label - Cleaner look
StatusLabel.Parent = ContentFrame
StatusLabel.BackgroundTransparency = 1
StatusLabel.Position = UDim2.new(0, 10, 0, 8)
StatusLabel.Size = UDim2.new(1, -20, 0, 22)
StatusLabel.Font = Enum.Font.Gotham
StatusLabel.Text = "Status: Disabled | Players: 0"
StatusLabel.TextColor3 = Color3.fromRGB(160, 160, 165)
StatusLabel.TextSize = 11
StatusLabel.TextXAlignment = Enum.TextXAlignment.Left

-- Function to create professional toggle button
local function CreateToggle(name, text, position, defaultState)
    local toggle = Instance.new("TextButton")
    toggle.Name = name
    toggle.Parent = ContentFrame
    toggle.BackgroundColor3 = defaultState and Color3.fromRGB(45, 85, 55) or Color3.fromRGB(35, 35, 40)
    toggle.BorderSizePixel = 0
    toggle.Position = position
    toggle.Size = UDim2.new(1, -20, 0, 34)
    toggle.Font = Enum.Font.Gotham
    toggle.Text = text
    toggle.TextColor3 = Color3.fromRGB(200, 200, 205)
    toggle.TextSize = 11
    toggle.TextWrapped = false
    
    local corner = Instance.new("UICorner")
    corner.CornerRadius = UDim.new(0, 6)
    corner.Parent = toggle
    
    -- Subtle border
    local stroke = Instance.new("UIStroke")
    stroke.Color = defaultState and Color3.fromRGB(70, 140, 80) or Color3.fromRGB(50, 50, 55)
    stroke.Thickness = 1
    stroke.Transparency = 0.3
    stroke.Parent = toggle
    
    return toggle
end

-- Create Toggles with cleaner spacing
local ESPToggle = CreateToggle("ESPToggle", "Master ESP", UDim2.new(0, 10, 0, 38), false)
local HighlightToggle = CreateToggle("HighlightToggle", "Player Highlight", UDim2.new(0, 10, 0, 78), true)
local HealthToggle = CreateToggle("HealthToggle", "Health Display", UDim2.new(0, 10, 0, 118), true)
local DistanceToggle = CreateToggle("DistanceToggle", "Distance Info", UDim2.new(0, 10, 0, 158), true)
local TracersToggle = CreateToggle("TracersToggle", "Tracer Lines", UDim2.new(0, 10, 0, 198), false)
local BoxToggle = CreateToggle("BoxToggle", "Box ESP", UDim2.new(0, 10, 0, 238), false)
local TeamCheckToggle = CreateToggle("TeamCheckToggle", "Ignore Teammates", UDim2.new(0, 10, 0, 278), false)

-- Notification Function
local function Notify(title, text, duration)
    pcall(function()
        game.StarterGui:SetCore("SendNotification", {
            Title = title;
            Text = text;
            Duration = duration or 2;
        })
    end)
end

-- Update Toggle Button with smooth animation
local function UpdateToggle(button, state, text)
    button.BackgroundColor3 = state and Color3.fromRGB(45, 85, 55) or Color3.fromRGB(35, 35, 40)
    button.Text = text
    
    local stroke = button:FindFirstChildOfClass("UIStroke")
    if stroke then
        stroke.Color = state and Color3.fromRGB(70, 140, 80) or Color3.fromRGB(50, 50, 55)
    end
end

-- Clear ESP for a player
local function ClearESP(player)
    if ESPObjects[player] then
        if ESPObjects[player].Highlight then
            ESPObjects[player].Highlight:Destroy()
        end
        if ESPObjects[player].BillboardGui then
            ESPObjects[player].BillboardGui:Destroy()
        end
        if ESPObjects[player].Tracer then
            ESPObjects[player].Tracer:Destroy()
        end
        if ESPObjects[player].BoxAdornment then
            ESPObjects[player].BoxAdornment:Destroy()
        end
        ESPObjects[player] = nil
    end
end

-- Clear all ESP
local function ClearAllESP()
    for player, _ in pairs(ESPObjects) do
        ClearESP(player)
    end
    ESPObjects = {}
end

-- Create ESP for player
local function CreateESP(player)
    if player == LocalPlayer then return end
    if not player.Character then return end
    if not player.Character:FindFirstChild("HumanoidRootPart") then return end
    
    if TeamCheckEnabled and player.Team == LocalPlayer.Team and player.Team ~= nil then
        return
    end
    
    ClearESP(player)
    ESPObjects[player] = {}
    
    -- Highlight
    if HighlightEnabled then
        local highlight = Instance.new("Highlight")
        highlight.Name = "WarpahESP"
        highlight.FillColor = Color3.fromRGB(0, 255, 0) -- Default hijau
        highlight.OutlineColor = Color3.fromRGB(255, 255, 255)
        highlight.FillTransparency = 0.5
        highlight.OutlineTransparency = 0
        highlight.Parent = player.Character
        ESPObjects[player].Highlight = highlight
    end
    
    -- BillboardGui for Health and Distance
    if HealthBarEnabled or DistanceEnabled then
        local billboard = Instance.new("BillboardGui")
        billboard.Name = "WarpahESP"
        billboard.Adornee = player.Character.HumanoidRootPart
        billboard.Size = UDim2.new(0, 200, 0, 50)
        billboard.StudsOffset = Vector3.new(0, 3, 0)
        billboard.AlwaysOnTop = true
        billboard.Parent = player.Character.HumanoidRootPart
        
        local textLabel = Instance.new("TextLabel")
        textLabel.Size = UDim2.new(1, 0, 1, 0)
        textLabel.BackgroundTransparency = 1
        textLabel.Font = Enum.Font.GothamBold
        textLabel.TextSize = 14
        textLabel.TextColor3 = Color3.fromRGB(255, 255, 255)
        textLabel.TextStrokeTransparency = 0.5
        textLabel.Parent = billboard
        
        ESPObjects[player].BillboardGui = billboard
        ESPObjects[player].TextLabel = textLabel
    end
    
    -- Box ESP
    if BoxESPEnabled then
        local box = Instance.new("BoxHandleAdornment")
        box.Name = "WarpahESP"
        box.Adornee = player.Character.HumanoidRootPart
        box.Size = player.Character.HumanoidRootPart.Size * 2
        box.Color3 = Color3.fromRGB(0, 255, 0) -- Default hijau
        box.Transparency = 0.7
        box.AlwaysOnTop = true
        box.ZIndex = 5
        box.Parent = player.Character.HumanoidRootPart
        ESPObjects[player].BoxAdornment = box
    end
    
    -- Tracers
    if TracersEnabled then
        local tracer = Drawing.new("Line")
        tracer.Visible = true
        tracer.Color = Color3.fromRGB(0, 255, 0) -- Default hijau
        tracer.Thickness = 2
        tracer.Transparency = 1
        ESPObjects[player].Tracer = tracer
    end
end

-- Update ESP
local function UpdateESP()
    if not ESPEnabled then return end
    
    local playerCount = 0
    
    for _, player in pairs(Players:GetPlayers()) do
        if player ~= LocalPlayer and player.Character and player.Character:FindFirstChild("HumanoidRootPart") then
            playerCount = playerCount + 1
            
            if not ESPObjects[player] then
                CreateESP(player)
            end
            
            -- Check if player is visible (not behind wall)
            local hrp = player.Character.HumanoidRootPart
            local camera = workspace.CurrentCamera
            local ray = Ray.new(camera.CFrame.Position, (hrp.Position - camera.CFrame.Position).Unit * 1000)
            local part, position = workspace:FindPartOnRayWithIgnoreList(ray, {LocalPlayer.Character, camera})
            
            local isVisible = false
            if part and part:IsDescendantOf(player.Character) then
                isVisible = true
            end
            
            -- Update colors based on visibility
            local color = isVisible and Color3.fromRGB(0, 255, 0) or Color3.fromRGB(255, 0, 0)
            
            -- Update Highlight color
            if ESPObjects[player].Highlight then
                ESPObjects[player].Highlight.FillColor = color
            end
            
            -- Update Box color
            if ESPObjects[player].BoxAdornment then
                ESPObjects[player].BoxAdornment.Color3 = color
            end
            
            -- Update Tracer color
            if ESPObjects[player].Tracer then
                ESPObjects[player].Tracer.Color = color
            end
            
            if ESPObjects[player] and ESPObjects[player].TextLabel then
                local humanoid = player.Character:FindFirstChild("Humanoid")
                
                local distance = (LocalPlayer.Character.HumanoidRootPart.Position - hrp.Position).Magnitude
                local health = humanoid and humanoid.Health or 0
                local maxHealth = humanoid and humanoid.MaxHealth or 100
                
                local text = ""
                if HealthBarEnabled then
                    local healthPercent = math.floor((health / maxHealth) * 100)
                    text = text .. string.format("HP: %d%% (%d/%d)", healthPercent, math.floor(health), math.floor(maxHealth))
                end
                if DistanceEnabled then
                    text = text .. (text ~= "" and "\n" or "") .. string.format("%dm", math.floor(distance))
                end
                
                ESPObjects[player].TextLabel.Text = player.Name .. "\n" .. text
                
                if HealthBarEnabled and humanoid then
                    local healthPercent = health / maxHealth
                    if healthPercent > 0.6 then
                        ESPObjects[player].TextLabel.TextColor3 = Color3.fromRGB(0, 255, 0)
                    elseif healthPercent > 0.3 then
                        ESPObjects[player].TextLabel.TextColor3 = Color3.fromRGB(255, 255, 0)
                    else
                        ESPObjects[player].TextLabel.TextColor3 = Color3.fromRGB(255, 0, 0)
                    end
                end
            end
            
            if TracersEnabled and ESPObjects[player] and ESPObjects[player].Tracer then
                local screenPos, onScreen = camera:WorldToViewportPoint(hrp.Position)
                
                if onScreen then
                    local screenCenter = Vector2.new(camera.ViewportSize.X / 2, camera.ViewportSize.Y)
                    ESPObjects[player].Tracer.From = screenCenter
                    ESPObjects[player].Tracer.To = Vector2.new(screenPos.X, screenPos.Y)
                    ESPObjects[player].Tracer.Visible = true
                else
                    ESPObjects[player].Tracer.Visible = false
                end
            end
        end
    end
    
    StatusLabel.Text = string.format("Status: %s | Players: %d", 
        ESPEnabled and "Active" or "Disabled",
        playerCount
    )
end

-- Toggle Functions
ESPToggle.MouseButton1Click:Connect(function()
    ESPEnabled = not ESPEnabled
    UpdateToggle(ESPToggle, ESPEnabled, "Master ESP")
    
    if ESPEnabled then
        Notify("WarpahVIP ESP", "ESP Enabled", 2)
        for _, player in pairs(Players:GetPlayers()) do
            if player ~= LocalPlayer then
                CreateESP(player)
            end
        end
    else
        Notify("WarpahVIP ESP", "ESP Disabled", 2)
        ClearAllESP()
    end
end)

HighlightToggle.MouseButton1Click:Connect(function()
    HighlightEnabled = not HighlightEnabled
    UpdateToggle(HighlightToggle, HighlightEnabled, "Player Highlight")
    Notify("Highlight", HighlightEnabled and "On" or "Off", 1)
    
    if ESPEnabled then
        ClearAllESP()
        for _, player in pairs(Players:GetPlayers()) do
            if player ~= LocalPlayer then
                CreateESP(player)
            end
        end
    end
end)

HealthToggle.MouseButton1Click:Connect(function()
    HealthBarEnabled = not HealthBarEnabled
    UpdateToggle(HealthToggle, HealthBarEnabled, "Health Display")
    Notify("Health Display", HealthBarEnabled and "On" or "Off", 1)
    
    if ESPEnabled then
        ClearAllESP()
        for _, player in pairs(Players:GetPlayers()) do
            if player ~= LocalPlayer then
                CreateESP(player)
            end
        end
    end
end)

DistanceToggle.MouseButton1Click:Connect(function()
    DistanceEnabled = not DistanceEnabled
    UpdateToggle(DistanceToggle, DistanceEnabled, "Distance Info")
    Notify("Distance", DistanceEnabled and "On" or "Off", 1)
end)

TracersToggle.MouseButton1Click:Connect(function()
    TracersEnabled = not TracersEnabled
    UpdateToggle(TracersToggle, TracersEnabled, "Tracer Lines")
    Notify("Tracers", TracersEnabled and "On" or "Off", 1)
    
    if ESPEnabled then
        ClearAllESP()
        for _, player in pairs(Players:GetPlayers()) do
            if player ~= LocalPlayer then
                CreateESP(player)
            end
        end
    end
end)

BoxToggle.MouseButton1Click:Connect(function()
    BoxESPEnabled = not BoxESPEnabled
    UpdateToggle(BoxToggle, BoxESPEnabled, "Box ESP")
    Notify("Box ESP", BoxESPEnabled and "On" or "Off", 1)
    
    if ESPEnabled then
        ClearAllESP()
        for _, player in pairs(Players:GetPlayers()) do
            if player ~= LocalPlayer then
                CreateESP(player)
            end
        end
    end
end)

TeamCheckToggle.MouseButton1Click:Connect(function()
    TeamCheckEnabled = not TeamCheckEnabled
    UpdateToggle(TeamCheckToggle, TeamCheckEnabled, "Ignore Teammates")
    Notify("Team Check", TeamCheckEnabled and "On" or "Off", 1)
    
    if ESPEnabled then
        ClearAllESP()
        for _, player in pairs(Players:GetPlayers()) do
            if player ~= LocalPlayer then
                CreateESP(player)
            end
        end
    end
end)

-- Minimize Toggle
local minimized = false
local originalSize = MainFrame.Size

MinimizeBtn.MouseButton1Click:Connect(function()
    minimized = not minimized
    if minimized then
        MainFrame:TweenSize(UDim2.new(0, 320, 0, 35), "Out", "Quad", 0.3, true)
        ContentFrame.Visible = false
        MinimizeBtn.Text = "□"
    else
        MainFrame:TweenSize(originalSize, "Out", "Quad", 0.3, true)
        ContentFrame.Visible = true
        MinimizeBtn.Text = "—"
    end
end)

-- Close Button
CloseBtn.MouseButton1Click:Connect(function()
    ClearAllESP()
    for _, connection in pairs(Connections) do
        connection:Disconnect()
    end
    ScreenGui:Destroy()
    Notify("WarpahVIP ESP", "Unloaded", 2)
end)

-- Player Added/Removed
Players.PlayerAdded:Connect(function(player)
    if ESPEnabled then
        wait(1)
        if player.Character then
            CreateESP(player)
        end
    end
end)

Players.PlayerRemoving:Connect(function(player)
    ClearESP(player)
end)

-- Character Added
for _, player in pairs(Players:GetPlayers()) do
    if player ~= LocalPlayer then
        player.CharacterAdded:Connect(function(character)
            if ESPEnabled then
                wait(0.5)
                CreateESP(player)
            end
        end)
        
        player.CharacterRemoving:Connect(function()
            ClearESP(player)
        end)
    end
end

-- Update Loop
table.insert(Connections, RunService.RenderStepped:Connect(function()
    UpdateESP()
end))

-- Startup
Notify("WarpahVIP ESP", "Loaded successfully", 2)
print("[WarpahVIP] ESP loaded successfully")
